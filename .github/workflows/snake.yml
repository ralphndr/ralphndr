name: Generate Snake

on:
  schedule:
    # Runs every 3 hours
    - cron: "0 */3 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Check out the code
    - uses: actions/checkout@v2

    # Debug step to print environment information
    - run: |
        echo "Checking environment variables and available directories"
        echo "Working directory: $(pwd)"
        echo "List of files:"
        ls -la

    # Generate the snake gif and svg
    - uses: Platane/snk@master
      id: snake-gif
      with:
        github_user_name: ralphndr
        gif_out_path: dist/github-contribution-grid-snake.gif
        svg_out_path: dist/github-contribution-grid-snake.svg
        days: 365 # Generate snake for 365 days

    # Debug step to check if the snake images were generated successfully
    - run: |
        echo "Checking if snake files are generated"
        ls -la dist/

    # Commit and push the generated snake images to the main branch
    - name: Commit and push snake image
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add dist/*
        git commit -m "Update contribution snake gif"
        git push origin main  # Change 'master' to 'main'

    # Deploy the generated snake via GitHub Pages
    - uses: crazy-max/ghaction-github-pages@v2.1.3
      with:
        target_branch: output
        build_dir: dist
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

